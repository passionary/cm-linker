<!DOCTYPE html>
<html>
<head>
	<title>example</title>
	<meta charset="utf-8">
	<link rel="stylesheet" href="bootstrap.css">
	<style>
		td {
			text-align: center;
		}		
		main {
			width: 80%;
			margin: 14px auto;
		}
		#cmd {
			position: relative;
			left:53%;
			top:10px;
		}
		#panel {
			height: 300px;
			margin-bottom: 14px;
			border-radius: 10px;
		}
		#panel p {
			font-size: 2rem;
			padding-top: 10%;		
		}
		#clear {
			position: absolute;
			right: 15px;
			top: 14px;
		}
		#adder {
			display: block;
			margin: 0 auto;
		}
	</style>
</head>
<body>	
	<div id="main">		
		<div id="app"></div>
	</div>
<script type="text/javascript" src="../dist/bundle.js"></script>
<script type="text/javascript">

	const app = Linker.register('#app', {
		name: 'app component',
		data:{
			result: '123',
			commandLine: [],
			commands: []
		},
		template: `
			<main>
				<h1 class="text-center mb-4">Command Panel</h1>
				<div class="bg-secondary" id="panel">
	
					<p class="text-center">{{result}}</p>

				</div>
				<input type="text" @keydown="execute" placeholder="command" class="form-control" />
				<br />
				<div class="d-flex justify-content-between">
					<div class="w-75">
						<div class="alert alert-success" l-if="show">eeeee! You won a surprise!</div>
						<table class="table table-bordered">
							<thead>
								<th class="text-center">Command</th>
							</thead>
							<tbody>
								<tr l-for="cmd in commandLine">
									<td>{{cmd}}</td>
								</tr>
							</tbody
						</table>
						<button class="btn btn-success" id="adder">add to list</button>
					</div>
					<div class="panel w-25"><input @keydown="command" placeholder="command" type="text" class="form-control" /><br /><input @keydown="action" placeholder="function" type="text" class="form-control" /><button class="btn btn-success" id="cmd" @click="addCommand">add command</button></div>			
				</div>							
			</main>
		`,
		methods: {
			command(e) {
				if(e.key == 'Enter')
				this.cmd = e.target.value
			},
			execute(e) {
				if(e.key === 'Enter') {
					const str = e.target.value
					const arg = str.match(/(?<=\()[\d]+(?=\))/)
					const c = str.match(/[\w]+(?=\()/)
					const cmd = this.commands.find(cm => cm.cmd == c[0])
					let body = 'x =' + arg[0] + '; ' + cmd.fnc
					this.result = eval(body)
				}
			},
			action(e) {
				if(e.key == 'Enter') this.action = e.target.value
			},
			addCommand() {
				const cmd = this.cmd.match(/[\w]+(?=:)/)
				const desc = this.cmd.match(/(?<=:\s).+/)
				if(cmd && desc)	{
					this.commandLine.push(`${this.cmd}, function: ${this.action}`)
					this.commands.push({cmd:cmd[0],fnc:this.action})
				}
			},
		}
	})

</script>
</body>
</html>
